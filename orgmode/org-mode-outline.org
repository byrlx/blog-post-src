#+OPTIONS: toc:t H:3
#+AUTHOR: Luis Xu
#+EMAIL: xuzhengchaojob@gmail.com
#+DATE: <2015-12-12 Thu 23:25>

#+TITLE: Orgmode手册1:文档结构

#+BEGIN_VERSE
[BG]: We’ve got a lot more books coming out in the pipeline. The one which is my favourite is the Emacs Org-Mode Reference Manual. Honestly, it’s the greatest Emacs mode in 20 years. 

[CW]: Would you say Org-Mode is one of the more exciting projects in the Free Software world at the moment? 

[BG]: Definitely. Maybe it’s even the most exciting. Certainly it’s transformed the way that I organise my work, and I think it has for a lot of other people as well, so it’s software that can revolutionise your life, not just perform a function.

                                                                                                      -- Brian Gough vs Chris Woolfrey
#+END_VERSE

这是Org mode手册系列的第一篇, 内容主要为阅读[[http://orgmode.org/manual/][Org Manual]]的笔记, 
对内容做了一些注解, 方便查阅. 

* 大纲模式(outline mode)
Org mode是建立在大纲视图(outline mode)之上的. 
大纲将笔记按照层级结构进行组织, 这种结构有两个好处:
1. 实现对文档的概括性浏览(只看大纲).
2. 只显示当前正在工作的部分,非工作部分可以隐藏. 

大纲模式在Org mode中具体实现方式为标题, 标题的写法很简单, 
在这一行的最开始加上1到多个星号即表示标题. 
"*"的数量表示这是个N级标题, N级标题为N-1级标题的子标题.
下图为一个标题的示例:

file:../../../../public/img/org-outline.png

* 创建标题
前面介绍过, 创建标题很简单, 一行的最前面写N个"*"即可,
同时org mode提供了一些快捷键来实现标题操作. 
标题中"树(tree"即为该标题和其所有子标题. 
表格中"割断"的意思是如果你在当前标题上使用快捷键来创建新标题,
有些快捷键可能会将该标题一分为二, 后半部分即为新标题的内容.
| 快捷键         | 功能                       | Note                     |
|----------------+----------------------------+--------------------------|
| M-RET          | 创建同级标题               | 可能会"割断"当前标题内容 |
| C-u C-u M-RET  | 在当前树的最后创建同级标题 |                          |
| C-RET          | 当前标题后面创建同级标题   | 不会"割断"               |
| M-S-RET        | 创建TODO标题               | 同M-RET                  |
| C-S-RET        | 创建TODO标题               | C-RET                    |
* 标题显示
前面说过, 大纲模式的一个好处就是可以折叠/显示标题, 这样可以方便你整体浏览大纲内容, 
或关注于当前的工作内容, 例如前面的例子折叠后变为下图, 这样就可以只关注
打开标题的内容.

file:../../../../public/img/org-outline2.png

这里是标题显示标题操作的一些快捷键
| 快捷键            | 功能                              | 对应命令                    |
|-------------------+-----------------------------------+-----------------------------|
| TAB               | 循环打开关闭当前标题              | org-cycle                   |
| S-TAB/C-u TAB     | 循环打开关闭所有标题              | org-global-cycle            |
| C-u C-u TAB       | 恢复到最初视图                    | org-set-startup-visibility  |
| C-u C-u C-u TAB   | 显示所有                          | show-all                    |
| C-c C-r           |                                   | org-reveal                  |
| C-c C-k           | 显示当前标题的所有子树标题        | show-branches               |
| (C-u N) C-c TAB   | 显示当前标题的(N层)子树           | show-children               |
| (C-u N) C-c C-x b | 在新buffer显示(从第N层开始的)子树 | org-tree-to-indirect-buffer |
| C-c C-x v         | 复制当前区域内容                  | org-copy-visible            |

* 标题间移动
org mode也提供了很多快捷键用来进行标题间的移动, 这样可以很方便的实现
章节的跳动.
| 快捷键         | 功能                   | Note           |
|----------------+------------------------+----------------|
| C-c C-n        | 移动到下个可见标题        |                |
| C-c C-p        | 移动到上个可见标题        |                |
| C-c C-f        | 移动到上个同级标题        |                |
| C-c C-b        | 移动到下个同级标题        |                |
| C-c C-u        | 移动到上级标题            |                |
| C-c C-j        | 跳到指定位置           |                |
| C-c &          | 跳回之前位置           |                |

* 改变标题级别
万能快捷键, 减少打字.
| 快捷键         | 功能                   | Note           |
|----------------+------------------------+----------------|
| TAB            | 改变空标题的level      |                |
| M-left/M-right | 升级/降级              |                |
| M-S-left/right | 所有子树升级/降级      |                |
| M-S-up/down    | 上移/下移              |                |
* 操作标题内容
下面的快捷键可以很方便的对标题下的内容进行操作, 勤加练习.
| 快捷键         | 功能                   | Note           |
|----------------+------------------------+----------------|
| M-h            | 标记当前内容           | 连击会标记更多 |
| C-c @          | 标记当前标题及内容     |                |
| C-c C-x C-w    | 剪切当前子树           |                |
| C-c C-x M-w    | 复制当前子树           |                |
| C-y            | 粘贴                   |                |
| C-c C-x c      | 复制多次               |                |
| C-c ^          | 排序标题               |                |
| C-x n s        | 让buffer只显示当前子树 |                |
| C-x n w        | 恢复buffer显示         |                |
| C-c *          | 添加/去掉星星          |                |

* 其他高级操作
** 初始化"可见性"
Emacs打开org文件默认只显示顶层标题, 可以通过 "#+STARTUP" 选项来配置
第一次打开要显示的内容. #+STARTUP的参数包括
| overview       | 只显示顶层标题 |
| content        | 显示所有标题   |
| showall        | 显示所有内容   |
| showeverything |                |
**** 编辑"不可见区域"报错
有时候会不小心编辑到"不可见区域", 编辑器默认不会报错, 所以如果想组织这个
行为, 可以在配置文件中设置org-catch-invisible-edits的值为非nil.例如下面
的代码, 这样就可以阻止编辑非可见区域.
#+BEGIN_SRC elisp
(setq-default org-catch-invisible-edits 'error)
#+END_SRC

org-catch-invisible-edits的更多参数可以参考 C-h v org-catch-invisible-edits 
** 稀疏树显示
Org mode的另一个功能就可以只展现你想要的内容, 称之为"稀疏树"展示.
使用快捷键"C-c /"可以调出稀疏树功能, 它会询问你想要显示的内容, 
如下图所示.

file:../../../../public/img/org-outline3.png

选择 '/' 或 "r" 会显示正则表达式搜索, 输入搜索内容即可以稀疏树方式展示结果, 如果
结果只在标题, 则显示标题, 如果在内容则显示内容, 搜索关键字会高亮. 按 "C-c C-c"会
取消高亮. 如果 C-u N之后输入C-c / r, 之前的N此搜索都会显示.
快捷键 "M-g n/p"用于在搜索结果之间跳转. 命令 "ps-print-buffer-with-faces"用于
打印机打印搜索结果.

稀疏树是org mode的很强大的搜索展示功能.后面的文章还会有更多介绍.
** 列表
org mode可以显示列表, 以下列字符开头的文本都为列表" - + 1. 1) *",
*标题的大部分快捷键都可以用于列表*, 其他的快捷键包括:
| C-c -        | 改变列表展示方式 |
| S-left/right | 同上             |
** 脚注
org mode支持脚注功能, 脚注通常用 =[fn:数字]= 表示, 然后在其他地方写上
脚注说明[fn:1]:
#+BEGIN_EXAMPLE
     The Org homepage[fn:1] now looks a lot better than it used to.
     ...
     [fn:1] The link is: http://orgmode.org
#+END_EXAMPLE
[fn:1]脚注示例.

