---
layout: post
title: feof() 需要多读一次
description: [Coding中遇到的知识点]
tag: [Tech]
---

最近写code大时候用到了feof()这个函数，后来程序运行一直不完美，调试的时候发现问题在feof()这边，明明已经到了文件末尾，但改函数仍返回false，导致多尽了一次while循环。

	while(!feof(fp)){
		fgets(buf,fp);
		.......
	}

后来上网查，发现问题是这样：
1. 对于feof()这个函数，必须先读一下fp（用fgets/fgetc), 它才能判断是否到了文件尾部。
2. 在读完文件的最后一个字符时，fp 的 flag 变量并未被置为_IOEOF,因为没有做最后一下读的动作。 而feof()在检查时就会认为文件没读完。

修改后的代码

	while(!feof(fp)){
		while(fgets(buf,fp) == NULL){
			break;
		}
		.......
	}
